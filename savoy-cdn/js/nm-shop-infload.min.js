/* NM: Shop infinite load script */
(function(e){e.extend(e.nmTheme,{infload_init:function(){var a=this.$shopBrowseWrap.children(".nm-pagination");a.length&&a.hasClass("nm-infload")&&this.shopInfLoadBind()},shopInfLoadBind:function(){var a=this,d=a.$shopBrowseWrap.children(".nm-infload-controls");a.shopInfLoadBound=!0;a.infloadScroll=d.hasClass("scroll-mode")?!0:!1;if(a.infloadScroll){a.infscrollLock=!1;var f,c=Math.round(a.$document.height()-d.offset().top),g=null;a.$window.resize(function(){g&&clearTimeout(g);g=setTimeout(function(){var b=
a.$shopBrowseWrap.children(".nm-infload-controls");c=Math.round(a.$document.height()-b.offset().top)},100)});a.$window.bind("smartscroll.infscroll",function(){a.infscrollLock||(f=0+a.$document.height()-a.$window.scrollTop()-a.$window.height(),f<c&&a.shopInfLoadGetPage())})}else d=e("#nm-shop-products"),d.on("click",".nm-infload-btn",function(b){b.preventDefault();a.shopInfLoadGetPage()}),d.on("click",".nm-infload-to-top",function(b){b.preventDefault();a.shopScrollToTop()});a.infloadScroll&&a.$window.trigger("scroll")},
shopInfLoadGetPage:function(){var a=this;if(a.shopAjax)return!1;a.shopRemoveNotices();var d=a.$shopBrowseWrap.children(".nm-infload-link").find("a"),f=a.$shopBrowseWrap.children(".nm-infload-controls"),c=d.attr("href"),g;c?(c=a.updateUrlParameter(c,"shop_load","products"),f.addClass("nm-loader"),a.$document.trigger("nm_infload_before",c),a.shopAjax=e.ajax({url:c,dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},method:"GET",error:function(b,h,k){console.log("NM: AJAX error - shopInfLoadGetPage() - "+
k)},complete:function(){f.removeClass("nm-loader")},success:function(b){b=e("<div>"+b+"</div>");var h=b.children(".nm-products").children("li");h.addClass("hide");g=a.$document.scrollTop();a.$shopBrowseWrap.find(".nm-products").append(h);"0"!=nm_wp_vars.infloadPreserveScrollPos&&a.isChromium&&a.$html.scrollTop(g);setTimeout(function(){h.removeClass("hide")},300);(c=b.find(".nm-infload-link").children("a").attr("href"))?d.attr("href",c):(a.$shopBrowseWrap.addClass("all-products-loaded"),a.infloadScroll?
a.infscrollLock=!0:f.addClass("hide-btn"),d.removeAttr("href"));a.shopAjax=!1;a.infloadScroll&&a.$window.trigger("scroll");a.$document.trigger("nm_infload_after",h)}})):a.infloadScroll&&(a.infscrollLock=!0)}});e.nmThemeExtensions.infload=e.nmTheme.infload_init})(jQuery);