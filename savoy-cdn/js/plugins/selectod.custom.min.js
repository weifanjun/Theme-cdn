/* (NM: custom version) selectordie.js 0.1.8 - Copyright (c) Per Vestman - Dual licensed under the MIT and GPL licenses. */
(function(d){d.fn.selectOrDie=function(u){var I={customID:null,customClass:"",placeholder:null,placeholderOption:!1,prefix:null,cycle:!1,stripEmpty:!1,links:!1,linksExternal:!1,size:0,tabIndex:0,onOpen:d.noop,onClose:d.noop,onChange:d.noop},g={},v=!1,G,x,f={initSoD:function(a){g=d.extend({},I,a);return this.each(function(){if(d(this).parent().hasClass("sod_select"))console.log("Select or Die: It looks like the SoD already exists");else{var b=d(this),c=b.data("custom-id")?b.data("custom-id"):g.customID,
e=b.data("custom-class")?b.data("custom-class"):g.customClass,h=b.data("prefix")?b.data("prefix"):g.prefix,k=b.data("placeholder")?b.data("placeholder"):g.placeholder,l=b.data("placeholder-option")?b.data("placeholder-option"):g.placeholderOption,m=b.data("cycle")?b.data("cycle"):g.cycle,p=b.data("links")?b.data("links"):g.links,q=b.data("links-external")?b.data("links-external"):g.linksExternal,y=parseInt(b.data("size"))?b.data("size"):g.size,D=parseInt(b.data("tabindex"))?b.data("tabindex"):g.tabIndex?
g.tabIndex:b.attr("tabindex")?b.attr("tabindex"):g.tabIndex,E=b.data("strip-empty")?b.data("strip-empty"):g.stripEmpty,z=b.prop("title")?b.prop("title"):null,n=b.is(":disabled")?" disabled":"",w="",A="",t=0;h&&(w='<span class="sod_prefix">'+h+"</span> ");var r=d("<span/>",{id:c,"class":"sod_select "+e+n,title:z,tabindex:D,html:k&&!h?A+('<span class="sod_label sod_placeholder">'+k+"</span>"):A+('<span class="sod_label">'+w+"</span>"),"data-cycle":m,"data-links":p,"data-links-external":q,"data-placeholder":k,
"data-placeholder-option":l,"data-prefix":h,"data-filter":""}).insertAfter(this);f.isTouch()&&r.addClass("touch");c=d("<span/>",{"class":"sod_list_wrapper"}).appendTo(r);var B=d("<span/>",{"class":"sod_list"}).appendTo(c);d("option, optgroup",b).each(function(F){var C=d(this);E&&!d.trim(C.text())?C.remove():0===F&&l&&!w?f.populateSoD(C,B,r,!0):f.populateSoD(C,B,r,!1)});y&&(c.show(),d(".sod_option:lt("+y+")",B).each(function(){t+=d(this).outerHeight()}),c.removeAttr("style"),B.css({"max-height":t}));
b.appendTo(r);r.on("focusin",f.focusSod).on("click",f.triggerSod).on("click",".sod_option",f.optionClick).on("mousemove",".sod_option",f.optionHover).on("keydown",f.keyboardUse);b.on("change",f.selectChange);d(document).on("click","label[for='"+b.attr("id")+"']",function(F){F.preventDefault();r.focus()})}})},populateSoD:function(a,b,c,e){var h=c.data("placeholder"),k=c.data("placeholder-option"),l=c.data("prefix"),m=c.find(".sod_label"),p=a.parent(),q=a.text(),y=a.val(),D=a.data("custom-id")?a.data("custom-id"):
null,E=a.data("custom-class")?a.data("custom-class"):"",z=a.is(":disabled")?" disabled ":"",n=a.is(":selected")?" selected active ":"",w=a.data("link")?" link ":"",A=a.data("link-external")?" linkexternal":"",t=a.prop("label");a.is("option")?(d("<span/>",{"class":"sod_option "+E+z+n+w+A,id:D,html:q,"data-value":y}).appendTo(b),e&&!l?(c.data("label",q),c.data("placeholder",q),a.prop("disabled",!0),b.find(".sod_option:last").addClass("is-placeholder disabled"),n&&m.addClass("sod_placeholder")):n&&h&&
!k&&!l?c.data("label",h):n&&c.data("label",q),(n&&!h||n&&k||n&&l)&&m.append(q),p.is("optgroup")&&(b.find(".sod_option:last").addClass("groupchild"),p.is(":disabled")&&b.find(".sod_option:last").addClass("disabled"))):d("<span/>",{"class":"sod_option optgroup "+z,title:t,html:t,"data-label":t}).appendTo(b)},focusSod:function(){var a=d(this);a.hasClass("disabled")?f.blurSod(a):(f.blurSod(d(".sod_select.focus").not(a)),a.addClass("focus"),d("html").on("click.sodBlur",function(){f.blurSod(a)}))},triggerSod:function(a){a.stopPropagation();
a=d(this);var b=a.find(".sod_list"),c=a.data("placeholder"),e=a.find(".active"),h=a.find(".selected");a.hasClass("disabled")||a.hasClass("open")||a.hasClass("touch")?(g.onClose.call(this),clearTimeout(x),a.removeClass("open"),c&&(a.find(".sod_label").get(0).lastChild.nodeValue=e.text())):(g.onOpen.call(this),a.addClass("open"),c&&!a.data("prefix")&&a.find(".sod_label").addClass("sod_placeholder").html(c),f.listScroll(b,h),f.checkViewport(a,b))},keyboardUse:function(a){var b=d(this),c=b.find(".sod_list"),
e=b.find(".sod_option"),h=b.find(".sod_label"),k=b.data("cycle"),l=e.filter(".active");if(36<a.which&&41>a.which){if(37===a.which||38===a.which){var m=l.prevAll(":not('.disabled, .optgroup')").first();var p=e.not(".disabled, .optgroup").last()}else if(39===a.which||40===a.which)m=l.nextAll(":not('.disabled, .optgroup')").first(),p=e.not(".disabled, .optgroup").first();!m.hasClass("sod_option")&&k&&(m=p);if(m.hasClass("sod_option")||k)l.removeClass("active"),m.addClass("active"),h.get(0).lastChild.nodeValue=
m.text(),f.listScroll(c,m),b.hasClass("open")||(v=!0);return!1}13===a.which||32===a.which&&b.hasClass("open")&&(" "===b.data("filter")[0]||""===b.data("filter"))?(a.preventDefault(),l.click()):32!==a.which||b.hasClass("open")||" "!==b.data("filter")[0]&&""!==b.data("filter")?27===a.which&&f.blurSod(b):(a.preventDefault(),v=!1,b.click());0!==a.which&&(clearTimeout(G),b.data("filter",b.data("filter")+String.fromCharCode(a.which)),a=e.filter(function(){return 0===d(this).text().toLowerCase().indexOf(b.data("filter").toLowerCase())}).not(".disabled, .optgroup").first(),
a.length&&(l.removeClass("active"),a.addClass("active"),f.listScroll(c,a),h.get(0).lastChild.nodeValue=a.text(),b.hasClass("open")||(v=!0)),G=setTimeout(function(){b.data("filter","")},500))},optionHover:function(){var a=d(this);a.hasClass("disabled")||a.hasClass("optgroup")||a.siblings().removeClass("active").end().addClass("active")},optionClick:function(a){a.stopPropagation();a=d(this);var b=a.closest(".sod_select"),c=a.hasClass("disabled"),e=a.hasClass("optgroup"),h=b.find(".sod_option:not('.optgroup')").index(this);
b.hasClass("touch")||(c||e||(b.find(".selected, .sod_placeholder").removeClass("selected sod_placeholder"),a.addClass("selected"),b.find("select option")[h].selected=!0,b.find("select").change()),clearTimeout(x),g.onClose.call(this),b.removeClass("open"))},selectChange:function(){var a=d(this),b=a.find(":selected"),c=b.text();a=a.closest(".sod_select");a.find(".sod_label").get(0).lastChild.nodeValue=c;a.data("label",c);g.onChange.call(this);!a.data("links")&&!b.data("link")||b.data("link-external")?
(a.data("links-external")||b.data("link-external"))&&window.open(b.val(),"_blank"):window.location.href=b.val()},blurSod:function(a){if(d("body").find(a).length){var b=a.data("label"),c=a.data("placeholder"),e=a.find(".active"),h=a.find(".selected"),k=!1;clearTimeout(x);v&&!e.hasClass("selected")?(e.click(),k=!0):e.hasClass("selected")||(e.removeClass("active"),h.addClass("active"));!k&&c?a.find(".sod_label").get(0).lastChild.nodeValue=h.text():k||(a.find(".sod_label").get(0).lastChild.nodeValue=
b);v=!1;g.onClose.call(a);a.removeClass("open focus");a.blur();d("html").off(".sodBlur")}},checkViewport:function(a,b){var c=a[0].getBoundingClientRect(),e=b.outerHeight();c.bottom+e+10>d(window).height()&&10<c.top-e?a.addClass("above"):a.removeClass("above");x=setTimeout(function(){f.checkViewport(a,b)},200)},listScroll:function(a,b){var c=a[0].getBoundingClientRect(),e=b[0].getBoundingClientRect();c.top>e.top?a.scrollTop(a.scrollTop()-c.top+e.top):c.bottom<e.bottom&&a.scrollTop(a.scrollTop()-c.bottom+
e.bottom)},isTouch:function(){return"ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints}},H={destroy:function(){return this.each(function(){var a=d(this),b=a.parent();b.hasClass("sod_select")?(a.off("change"),b.find("span").remove(),a.unwrap()):console.log("Select or Die: There's no SoD to destroy")})},update:function(){return this.each(function(){var a=d(this),b=a.parent(),c=b.find(".sod_list:first");b.hasClass("sod_select")?(c.empty(),b.find(".sod_label").get(0).lastChild.nodeValue=
"",a.is(":disabled")&&b.addClass("disabled"),d("option, optgroup",a).each(function(){f.populateSoD(d(this),c,b)})):console.log("Select or Die: There's no SoD to update")})},disable:function(a){return this.each(function(){var b=d(this),c=b.parent();c.hasClass("sod_select")?"undefined"!==typeof a?(c.find(".sod_list:first .sod_option[data-value='"+a+"']").addClass("disabled"),c.find(".sod_list:first .sod_option[data-label='"+a+"']").nextUntil(":not(.groupchild)").addClass("disabled"),d("option[value='"+
a+"'], optgroup[label='"+a+"']",this).prop("disabled",!0)):c.hasClass("sod_select")&&(c.addClass("disabled"),b.prop("disabled",!0)):console.log("Select or Die: There's no SoD to disable")})},enable:function(a){return this.each(function(){var b=d(this),c=b.parent();c.hasClass("sod_select")?"undefined"!==typeof a?(c.find(".sod_list:first .sod_option[data-value='"+a+"']").removeClass("disabled"),c.find(".sod_list:first .sod_option[data-label='"+a+"']").nextUntil(":not(.groupchild)").removeClass("disabled"),
d("option[value='"+a+"'], optgroup[label='"+a+"']",this).prop("disabled",!1)):c.hasClass("sod_select")&&(c.removeClass("disabled"),b.prop("disabled",!1)):console.log("Select or Die: There's no SoD to enable")})}};if(H[u])return H[u].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof u&&u)d.error('Select or Die: Oh no! No such method "'+u+'" for the SoD instance');else return f.initSoD.apply(this,arguments)}})(jQuery);