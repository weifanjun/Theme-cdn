/* NM: Shop filters script */
(function(b){b.extend(b.nmTheme,{filters_init:function(){this.$shopFilterMenu=b("#nm-shop-filter-menu");this.$shopSidebarPopupBtn=b("#nm-shop-sidebar-popup-button");this.shopSidebarLayout=b("#nm-shop-sidebar").data("sidebar-layout");this.filterPanelSliding=!1;this.filterPanelSlideSpeed=200;this.filterPanelHideWidth=551;this.shopFilterMenuFnNames={cat:"shopFiltersCategoriesToggle",filter:"shopFiltersSidebarToggle",sidebar:"shopDefaultSidebarToggle",search:"shopFiltersSearchToggle"};this.shopFiltersBind()},
shopFiltersBind:function(){var a=this;if(a.filtersEnableAjax)a.$header.on("click.nmHeaderShopAjax",".shop-ajax-link",function(c){c.preventDefault();var h=b(this),g=h.parents(".menu-item").last();g.addClass("no-hover");a.shopFiltersSearchClose();b("#nm-shop-categories").children(".current-cat").removeClass("current-cat");c=a.shopScrollToTop();setTimeout(function(){a.shopGetPage(h.children("a").attr("href"));setTimeout(function(){g.removeClass("no-hover")},100)},c)});a.$shopFilterMenu.find("a").bind("click",
function(c){c.preventDefault();if(!a.filterPanelSliding){a.shopRemoveNotices();a.filterPanelSliding=!0;c=0;var h=b(this).parent("li"),g=h.data("panel");h.hasClass("active")||(c=a.shopFiltersHideActivePanel());h.toggleClass("active");setTimeout(function(){a[a.shopFilterMenuFnNames[g]]()},c)}});if(a.filtersEnableAjax&&a.$pageIncludes.hasClass("shop_categories"))a.$shopWrap.on("click","#nm-shop-categories a",function(c){c.preventDefault();c=b(this);var h=c.parent("li");a.shopFiltersSearchClose();b("#nm-shop-categories").children(".current-cat").removeClass("current-cat");
h.addClass("current-cat");a.shopGetPage(c.attr("href"))});if(a.$shopSidebarPopupBtn.length){a.$shopSidebarPopup=b("#nm-shop-sidebar-popup");var d=null;a.$window.bind("scroll.nmShopPopupBtn resize.nmShopPopupBtn",function(){d&&clearTimeout(d);d=setTimeout(function(){a.$body.hasClass("shop-filters-popup-open")||a.shopFiltersPopupButtonToggle()},500)});a.$shopSidebarPopupBtn.bind("click",function(){a.shopFiltersPopupShow()});b("#nm-shop-sidebar-popup-reset-button").bind("click",function(c){c.preventDefault();
a.shopFiltersPopupReset()})}var f=a.isTouch?!1:!0,e=!1;a.$shopWrap.on("click","#nm-shop-sidebar .nm-widget-title",function(c){c=b(this).closest("li");if(c.hasClass("show"))f&&c.children(".nm-shop-widget-col").last().css("height",""),c.removeClass("show");else{var h=c.parent("#nm-shop-widgets-ul").children(".show");if(f){var g=c.children(".nm-shop-widget-col").last(),k=g.children().first().outerHeight(!0)+"px",l=h.children(".nm-shop-widget-col").last();g.css("height",k);l.css("height","");e||(e=!0,
a.$window.one("resize.nmShopWidget",function(){a.shopFiltersWidgetHideOpen();e=!1}))}h.removeClass("show");c.addClass("show")}});a.filtersEnableAjax&&a.$pageIncludes.hasClass("shop_filters")&&(a.$shopWrap.on("click","#nm-shop-sidebar .nm_widget a",function(c){c.preventDefault();a.shopGetPage(b(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_product_categories a",function(c){c.preventDefault();a.shopGetPage(b(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_layered_nav a",
function(c){c.preventDefault();a.shopGetPage(b(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_layered_nav_filters a",function(c){c.preventDefault();a.shopGetPage(b(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_product_tag_cloud a",function(c){c.preventDefault();a.shopGetPage(b(this).attr("href"),!1,!0)}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_rating_filter a",function(c){c.preventDefault();a.shopGetPage(b(this).attr("href"))}),a.$body.on("price_slider_change",
function(c,h,g){c=b("#nm-shop-sidebar").find(".widget_price_filter").first().find("form");var k=parseInt(c.find("#min_price").attr("value")),l=parseInt(c.find("#max_price").attr("value"));if(k!=h||l!=g)h=c.attr("action"),g=c.serialize(),a.shopGetPage(h+"?"+g)}))},shopFiltersCategoriesToggle:function(){var a=this,d=b("#nm-shop-categories"),f=d.is(":visible");f&&d.removeClass("fade-in");d.slideToggle(a.filterPanelSlideSpeed,function(){f?d.removeClass("force-show").css("display",""):d.addClass("fade-in");
a.filterPanelSliding=!1})},shopFiltersCategoriesReset:function(){b("#nm-shop-categories").removeClass("fade-in force-show").css("display","")},shopFiltersSidebarToggle:function(){var a=this,d=b("#nm-shop-sidebar"),f=d.is(":visible");f&&d.removeClass("fade-in");d.slideToggle(a.filterPanelSlideSpeed,function(){f||d.addClass("fade-in");a.filterPanelSliding=!1})},shopFiltersWidgetHideOpen:function(){var a=b("#nm-shop-widgets-ul").children(".show");a.length&&a.find(".nm-widget-title").trigger("click")},
shopDefaultSidebarToggle:function(){var a=this,d=b("#nm-shop-sidebar"),f=d.is(":visible");f&&d.removeClass("fade-in");d.slideToggle(a.filterPanelSlideSpeed,function(){f||d.addClass("fade-in");a.filterPanelSliding=!1})},shopFiltersSearchToggle:function(){this.shopSearchTogglePanel();this.currentSearch=""},shopFiltersSearchClose:function(){this.searchEnabled&&this.$searchBtn.parent("li").hasClass("active")&&(this.categoryClicked=!0,this.$searchBtn.trigger("click"))},shopFiltersHideActivePanel:function(){var a=
0,d=this.$shopFilterMenu.children(".active");if(d.length){d.removeClass("active");var f=d.data("panel");d.is(":hidden")&&"cat"==f?this.shopFiltersCategoriesReset():(a=300,this[this.shopFilterMenuFnNames[f]]())}return a},shopFiltersPopupButtonToggle:function(){var a=this.$shopSidebarPopupBtn.hasClass("visible")?this.$shopSidebarPopupBtn.offset().top+this.$shopSidebarPopupBtn.outerHeight(!0):this.$shopSidebarPopupBtn.offset().top,d=this.$shopBrowseWrap.offset().top;a>d+190?this.shopFiltersPopupButtonShow():
this.shopFiltersPopupButtonHide()},shopFiltersPopupButtonShow:function(){this.$shopSidebarPopupBtn.addClass("visible")},shopFiltersPopupButtonHide:function(){this.$shopSidebarPopupBtn.removeClass("visible")},shopFiltersPopupShow:function(){var a=this;a.shopFiltersPopupButtonHide();a.$shopSidebarPopup.addClass("visible");a.$body.addClass("shop-filters-popup-open");a.$document.bind("mouseup.filtersPopup",function(d){a.$shopSidebarPopup.is(d.target)||0!==a.$shopSidebarPopup.has(d.target).length||a.shopFiltersPopupHide()})},
shopFiltersPopupHide:function(){var a=this;a.$shopSidebarPopup.removeClass("visible");a.shopFiltersPopupButtonToggle();a.$body.removeClass("shop-filters-popup-open");a.$document.unbind("mouseup.filtersPopup");setTimeout(function(){a.searchHideNotice()},a.panelsAnimSpeed)},shopFiltersPopupReset:function(){var a=location.href.replace(location.search,"");this.shopGetPage(a);this.shopFiltersPopupHide()},shopExternalGetPage:function(a){var d=this;if(a==window.location.href)d.shopScrollToTop();else{b("#nm-shop-categories").children(".current-cat").removeClass("current-cat");
var f=d.shopScrollToTop();setTimeout(function(){d.shopGetPage(a)},f)}},shopGetPage:function(a,d,f){var e=this;if(e.shopAjax)return!1;a&&(e.shopRemoveNotices(),"popup"==e.shopSidebarLayout&&e.shopFiltersPopupHide(),e.$body.width()<e.filterPanelHideWidth?(e.shopShowLoader(!0),f=e.filterPanelSlideSpeed,e.filterPanelSlideSpeed=0,e.shopFiltersHideActivePanel(),e.filterPanelSlideSpeed=f):e.shopShowLoader(),a=a.replace(/\/?(\?|#|$)/,"/$1"),d||e.setPushState(a),e.shopAjax=b.ajax({url:a,data:{shop_load:"full",
shop_filters_layout:e.shopSidebarLayout},dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},method:"POST",error:function(c,h,g){console.log("NM: AJAX error - shopGetPage() - "+g);e.shopHideLoader();e.shopAjax=!1},success:function(c){e.shopUpdateContent(c);e.shopAjax=!1}}))},shopUpdateContent:function(a){var d=this;a=b("<div>"+a+"</div>");if(nm_wp_vars.shopAjaxUpdateTitle){var f=a.find("#nm-wp-title").text();f.length&&(document.title=f)}var e=a.find("#nm-body-class"),c=a.find("#nm-shop-taxonomy-header"),
h=a.find(".nm-shop-taxonomy-heading");f=a.find("#nm-shop-categories");var g=a.find("#nm-shop-widgets-ul"),k=a.find("#nm-shop-browse-wrap");e.hasClass("post-type-archive")?d.$body.removeClass("tax-product_cat tax-product_tag").addClass("post-type-archive post-type-archive-product"):e.hasClass("tax-product_cat")?d.$body.removeClass("post-type-archive post-type-archive-product tax-product_tag").addClass("tax-product_cat"):e.hasClass("tax-product_tag")&&d.$body.removeClass("post-type-archive post-type-archive-product tax-product_cat").addClass("tax-product_tag");
if(c.length){e=b("#nm-shop-taxonomy-header");var l=e.children(".nm-shop-taxonomy-header-inner").css("background-image"),m=c.children(".nm-shop-taxonomy-header-inner").css("background-image");l!==m&&e.replaceWith(c);e.removeClass("hidden")}else b("#nm-shop-taxonomy-header").addClass("hidden");h.length?b(".nm-shop-taxonomy-heading").replaceWith(h):b(".nm-shop-taxonomy-heading").addClass("hidden");f.length&&(c=b("#nm-shop-categories"),c.hasClass("fade-in")&&f.addClass("fade-in force-show"),c.replaceWith(f));
g.length&&(b("#nm-shop-widgets-ul").replaceWith(g),d.shopFiltersInitPriceSlider());k.length&&d.$shopBrowseWrap.replaceWith(k);d.$document.trigger("nm_ajax_shop_update_content",a);d.$shopBrowseWrap=b("#nm-shop-browse-wrap");d.shopInfLoadBound||d.infload_init();a=d.shopScrollToTop();setTimeout(function(){d.shopHideLoader()},a)},shopFiltersInitPriceSlider:function(){if("undefined"===typeof woocommerce_price_slider_params)return!1;b(document.body).bind("price_slider_create price_slider_slide",function(a,
d,f){b(".price_slider_amount span.from").html(accounting.formatMoney(d,{symbol:woocommerce_price_slider_params.currency_format_symbol,decimal:woocommerce_price_slider_params.currency_format_decimal_sep,thousand:woocommerce_price_slider_params.currency_format_thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:woocommerce_price_slider_params.currency_format}));b(".price_slider_amount span.to").html(accounting.formatMoney(f,{symbol:woocommerce_price_slider_params.currency_format_symbol,
decimal:woocommerce_price_slider_params.currency_format_decimal_sep,thousand:woocommerce_price_slider_params.currency_format_thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:woocommerce_price_slider_params.currency_format}));b(document.body).trigger("price_slider_updated",[d,f])});(function(){b("input#min_price, input#max_price").hide();b(".price_slider, .price_label").show();var a=b(".price_slider_amount #min_price").data("min"),d=b(".price_slider_amount #max_price").data("max"),
f=b(".price_slider_amount").data("step")||1,e=b(".price_slider_amount #min_price").val(),c=b(".price_slider_amount #max_price").val();b(".price_slider:not(.ui-slider)").slider({range:!0,animate:!0,min:a,max:d,step:f,values:[e,c],create:function(){b(".price_slider_amount #min_price").val(e);b(".price_slider_amount #max_price").val(c);b(document.body).trigger("price_slider_create",[e,c])},slide:function(h,g){b("input#min_price").val(g.values[0]);b("input#max_price").val(g.values[1]);b(document.body).trigger("price_slider_slide",
[g.values[0],g.values[1]])},change:function(h,g){b(document.body).trigger("price_slider_change",[g.values[0],g.values[1]])}})})()}});b.nmThemeExtensions.filters=b.nmTheme.filters_init})(jQuery);