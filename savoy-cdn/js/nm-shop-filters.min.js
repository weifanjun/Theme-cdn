/* NM: Shop filters script */
(function(c){c.extend(c.nmTheme,{filters_init:function(){this.$shopFilterMenu=c("#nm-shop-filter-menu");this.$shopSidebarPopupBtn=c("#nm-shop-sidebar-popup-button");this.shopSidebarLayout=c("#nm-shop-sidebar").data("sidebar-layout");this.filterPanelSliding=!1;this.filterPanelSlideSpeed=200;this.filterPanelHideWidth=551;this.shopFilterMenuFnNames={cat:"shopFiltersCategoriesToggle",filter:"shopFiltersSidebarToggle",search:"shopFiltersSearchToggle"};this.shopFiltersBind()},shopFiltersBind:function(){var a=
this;if(a.filtersEnableAjax)a.$header.on("click.nmHeaderShopAjax",".shop-ajax-link",function(b){b.preventDefault();var g=c(this),h=g.parents(".menu-item").last();h.addClass("no-hover");a.shopFiltersSearchClose();c("#nm-shop-categories").children(".current-cat").removeClass("current-cat");b=a.shopScrollToTop();setTimeout(function(){a.shopGetPage(g.children("a").attr("href"));setTimeout(function(){h.removeClass("no-hover")},100)},b)});a.$shopFilterMenu.find("a").bind("click",function(b){b.preventDefault();
if(!a.filterPanelSliding){a.shopRemoveNotices();a.filterPanelSliding=!0;b=0;var g=c(this).parent("li"),h=g.data("panel");g.hasClass("active")||(b=a.shopFiltersHideActivePanel());g.toggleClass("active");setTimeout(function(){a[a.shopFilterMenuFnNames[h]]()},b)}});if(a.filtersEnableAjax&&a.$pageIncludes.hasClass("shop_categories"))a.$shopWrap.on("click","#nm-shop-categories a",function(b){b.preventDefault();b=c(this);var g=b.parent("li");a.shopFiltersSearchClose();c("#nm-shop-categories").children(".current-cat").removeClass("current-cat");
g.addClass("current-cat");a.shopGetPage(b.attr("href"))});if(a.$shopSidebarPopupBtn.length){a.$shopSidebarPopup=c("#nm-shop-sidebar-popup");var d=null;a.$window.bind("scroll.nmShopPopupBtn resize.nmShopPopupBtn",function(){d&&clearTimeout(d);d=setTimeout(function(){a.$body.hasClass("shop-filters-popup-open")||a.shopFiltersPopupButtonToggle()},500)});a.$shopSidebarPopupBtn.bind("click",function(){a.shopFiltersPopupShow()});c("#nm-shop-sidebar-popup-reset-button").bind("click",function(b){b.preventDefault();
a.shopFiltersPopupReset()})}var f=a.isTouch?!1:!0,e=!1;a.$shopWrap.on("click","#nm-shop-sidebar .nm-widget-title",function(b){b=c(this).closest("li");if(b.hasClass("show"))f&&b.children(".nm-shop-widget-col").last().css("height",""),b.removeClass("show");else{var g=b.parent("#nm-shop-widgets-ul").children(".show");if(f){var h=b.children(".nm-shop-widget-col").last(),k=h.children().first().outerHeight(!0)+"px",l=g.children(".nm-shop-widget-col").last();h.css("height",k);l.css("height","");e||(e=!0,
a.$window.one("resize.nmShopWidget",function(){a.shopFiltersWidgetHideOpen();e=!1}))}g.removeClass("show");b.addClass("show")}});a.filtersEnableAjax&&a.$pageIncludes.hasClass("shop_filters")&&(a.$shopWrap.on("click","#nm-shop-sidebar .nm_widget a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_product_categories a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_layered_nav a",
function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_layered_nav_filters a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_product_tag_cloud a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"),!1,!0)}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_rating_filter a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}))},shopFiltersCategoriesToggle:function(){var a=
this;c("#nm-shop-categories").slideToggle(a.filterPanelSlideSpeed,function(){var d=c(this);d.toggleClass("fade-in");d.hasClass("fade-in")||d.removeClass("force-show").css("display","");a.filterPanelSliding=!1})},shopFiltersCategoriesReset:function(){c("#nm-shop-categories").removeClass("fade-in force-show").css("display","")},shopFiltersSidebarToggle:function(){var a=this,d=c("#nm-shop-sidebar"),f=d.is(":visible");f&&d.removeClass("fade-in");d.slideToggle(a.filterPanelSlideSpeed,function(){f||d.addClass("fade-in");
a.filterPanelSliding=!1})},shopFiltersWidgetHideOpen:function(){var a=c("#nm-shop-widgets-ul").children(".show");a.length&&a.find(".nm-widget-title").trigger("click")},shopFiltersSearchToggle:function(){this.shopSearchTogglePanel();this.currentSearch=""},shopFiltersSearchClose:function(){this.searchEnabled&&this.$searchBtn.parent("li").hasClass("active")&&(this.categoryClicked=!0,this.$searchBtn.trigger("click"))},shopFiltersHideActivePanel:function(){var a=0,d=this.$shopFilterMenu.children(".active");
if(d.length){d.removeClass("active");var f=d.data("panel");d.is(":hidden")&&"cat"==f?this.shopFiltersCategoriesReset():(a=300,this[this.shopFilterMenuFnNames[f]]())}return a},shopFiltersPopupButtonToggle:function(){var a=this.$shopSidebarPopupBtn.hasClass("visible")?this.$shopSidebarPopupBtn.offset().top+this.$shopSidebarPopupBtn.outerHeight(!0):this.$shopSidebarPopupBtn.offset().top,d=this.$shopBrowseWrap.offset().top;a>d+190?this.shopFiltersPopupButtonShow():this.shopFiltersPopupButtonHide()},shopFiltersPopupButtonShow:function(){this.$shopSidebarPopupBtn.addClass("visible")},
shopFiltersPopupButtonHide:function(){this.$shopSidebarPopupBtn.removeClass("visible")},shopFiltersPopupShow:function(){var a=this;a.shopFiltersPopupButtonHide();a.$shopSidebarPopup.addClass("visible");a.$body.addClass("shop-filters-popup-open");a.$document.bind("mouseup.filtersPopup",function(d){a.$shopSidebarPopup.is(d.target)||0!==a.$shopSidebarPopup.has(d.target).length||a.shopFiltersPopupHide()})},shopFiltersPopupHide:function(){var a=this;a.$shopSidebarPopup.removeClass("visible");a.shopFiltersPopupButtonToggle();
a.$body.removeClass("shop-filters-popup-open");a.$document.unbind("mouseup.filtersPopup");setTimeout(function(){a.searchHideNotice()},a.panelsAnimSpeed)},shopFiltersPopupReset:function(){var a=location.href.replace(location.search,"");this.shopGetPage(a);this.shopFiltersPopupHide()},shopExternalGetPage:function(a){var d=this;if(a==window.location.href)d.shopScrollToTop();else{c("#nm-shop-categories").children(".current-cat").removeClass("current-cat");var f=d.shopScrollToTop();setTimeout(function(){d.shopGetPage(a)},
f)}},shopGetPage:function(a,d,f){var e=this;if(e.shopAjax)return!1;a&&(e.shopRemoveNotices(),"popup"==e.shopSidebarLayout&&e.shopFiltersPopupHide(),e.$body.width()<e.filterPanelHideWidth?(e.shopShowLoader(!0),f=e.filterPanelSlideSpeed,e.filterPanelSlideSpeed=0,e.shopFiltersHideActivePanel(),e.filterPanelSlideSpeed=f):e.shopShowLoader(),a=a.replace(/\/?(\?|#|$)/,"/$1"),d||e.setPushState(a),e.shopAjax=c.ajax({url:a,data:{shop_load:"full",shop_filters_layout:e.shopSidebarLayout},dataType:"html",cache:!1,
headers:{"cache-control":"no-cache"},method:"POST",error:function(b,g,h){console.log("NM: AJAX error - shopGetPage() - "+h);e.shopHideLoader();e.shopAjax=!1},success:function(b){e.shopUpdateContent(b);e.shopAjax=!1}}))},shopUpdateContent:function(a){var d=this;a=c("<div>"+a+"</div>");if(nm_wp_vars.shopAjaxUpdateTitle){var f=a.find("#nm-wp-title").text();f.length&&(document.title=f)}var e=a.find("#nm-shop-taxonomy-header"),b=a.find(".nm-shop-taxonomy-heading");f=a.find("#nm-shop-categories");var g=
a.find("#nm-shop-widgets-ul"),h=a.find("#nm-shop-browse-wrap");if(e.length){var k=c("#nm-shop-taxonomy-header"),l=k.children(".nm-shop-taxonomy-header-inner").css("background-image"),m=e.children(".nm-shop-taxonomy-header-inner").css("background-image");l!==m&&k.replaceWith(e);k.removeClass("hidden")}else c("#nm-shop-taxonomy-header").addClass("hidden");b.length?c(".nm-shop-taxonomy-heading").replaceWith(b):c(".nm-shop-taxonomy-heading").addClass("hidden");f.length&&(e=c("#nm-shop-categories"),e.hasClass("fade-in")&&
f.addClass("fade-in force-show"),e.replaceWith(f));g.length&&c("#nm-shop-widgets-ul").replaceWith(g);h.length&&d.$shopBrowseWrap.replaceWith(h);d.$document.trigger("nm_ajax_shop_update_content",a);d.$shopBrowseWrap=c("#nm-shop-browse-wrap");d.shopInfLoadBound||d.infload_init();a=d.shopScrollToTop();setTimeout(function(){d.shopHideLoader()},a)}});c.nmThemeExtensions.filters=c.nmTheme.filters_init})(jQuery);